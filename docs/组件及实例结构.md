# 组件及实例结构

> 按照一定的结构组织，使得组件便于理解

按照特定的结构组织代码，有以下优点：

- 导出一个清晰、组织有序的组件，使得代码易于阅读和理解。同时也便于标准化
- 按首字母排序属性，使得属性便于查找。
- 合理组织，使得组件易于阅读。
- 使用 name 属性。借助于 [vue devtools](https://chrome.google.com/webstore/detail/vuejs-devtools/nhdogjmejiglipccpnnnanhbledajbpd?hl=en) 可以让你更方便的测试
- 使用单文件 .vue 文件格式来组件代码

## 组件/实例的选项的顺序

**组件/实例的选项应该有统一的顺序**

这是我们推荐的组件选项默认顺序。它们被划分为几大类，所以你也能知道从插件里添加的新属性应该放到哪里。

1. **副作用**（触发组件外的影响）

  * `el`

2. **全局感知**（要求组件以外的知识）

  * `name`
  * `parent`

3. **组件类型**（更改组件的类型）

  * `functional`

4. **模板修改器**（改变模板的编译方式）

  * `delimiters`
  * `comments`

5. **模板依赖**（模板内使用的资源）

  * `components`
  * `directives`
  * `filters`

6. **组合**（向选项里合并属性）

  * `extends`
  * `mixins`

7. **接口**（组件的接口）

  * `inheritAttrs`
  * `model`
  * `props` / `propsData`

8. **本地状态**（本地的响应式属性）

  * `data`
  * `computed`

9. **事件**（通过响应式事件触发的回调）

  * `watch`
  * 生命周期钩子（按照它们被调用的顺序）

10. **非响应式的属性**（不依赖响应系统的实例属性）

  * `methods`

11. **渲染**（组件输出的声明式描述）

  * `template` / `render`
  * `renderError`

## Prop 定义

**Prop 定义应该尽量详细。**

在你提交的代码中，prop的定义应该尽量详细，至少需要指定其类型。

详细的 [prop 定义](https://vuefe.cn/v2/guide/components.html#Prop-验证)有两个好处：

- 它们写明了组件的 API，所以很容易看懂组件的用法；
- 在开发环境下，如果向一个组件提供格式不正确的 prop，Vue 将会告警，以帮助你捕获潜在的错误来源。

```javascript
// 推荐
props: {
  status: String
}

// 更好的做法！
props: {
  status: {
    type: String,
    required: true,
    validator: function (value) {
      return [
        'syncing',
        'synced',
        'version-conflict',
        'error'
      ].indexOf(value) !== -1
    }
  }
}

// 不推荐
// 这样做只有开发原型系统时可以接受
props: ['status']
```

## Prop 名大小写

**在声明 prop 的时候，其命名应该使用使用 camelCase ，而在模板和 [JSX](https://vuefe.cn/v2/guide/render-function.html#JSX) 中应该始终使用 kebab-case**

我们单纯的遵循每个语言的约定。在 JavaScript 中更自然的是 camelCase。而在 HTML 中则是 kebab-case。

```javascript
// 推荐
props: {
  greetingText: String
}

<WelcomeMessage greeting-text="hi"/>

// 不推荐
props: {
  'greeting-text': String
}

<WelcomeMessage greetingText="hi"/>
```

## 组件数据

**组件的 `data` 必须是一个函数**

当在组件中使用 `data` 属性的时候（除了 `new Vue` 外的任何地方），它的值必须是返回一个对象的函数。

当 `data` 的值是一个对象时，它会在这个组件的所有实例之间共享。想象一个，假如一个 `TodoList` 组件的数据是这样的：

```javascript
data: {
  listTitle: '',
  todos: []
}
```

我们可能希望重用这个组件，允许用户维护多个列表 (比如分为购物、心愿单、日常事务等)。这时就会产生问题。因为每个组件的实例都引用了相同的数据对象，更改其中一个列表的标题就会改变其它每一个列表的标题。增删改一个待办事项的时候也是如此。

取而代之的是，我们希望每个组件实例都管理其自己的数据。为了做到这一点，每个实例必须生成一个独立的数据对象。在 JavaScript 中，在一个函数中返回这个对象就可以了：

```javascript
data: function () {
  return {
    listTitle: '',
    todos: []
  }
}
```

```javascript
// 推荐
Vue.component('some-comp', {
  data: function () {
    return {
      foo: 'bar'
    }
  }
})

// In a .vue file
export default {
  data () {
    return {
      foo: 'bar'
    }
  }
}

// 在一个 Vue 的根实例上
// 直接使用对象是可以的，
// 因为只存在一个这样的实例。
new Vue({
  data: {
    foo: 'bar'
  }
})

// 不推荐
Vue.component('some-comp', {
  data: {
    foo: 'bar'
  }
})

export default {
  data: {
    foo: 'bar'
  }
}
```

## 简单的计算属性

**应该把复杂计算属性分割为尽可能多的更简单的属性。**

更简单、命名得当的计算属性是这样的：

- **易于测试**

  当每个计算属性都包含一个非常简单且很少依赖的表达式时，撰写测试以确保其正确工作就会更加容易。

- **易于阅读**

  简化计算属性要求你为每一个值都起一个描述性的名称，即便它不可复用。这使得其他开发者 (以及未来的你) 更容易专注在他们关心的代码上并搞清楚发生了什么。

- **更好的“拥抱变化”**

  任何能够命名的值都可能用在视图上。举个例子，我们可能打算展示一个信息，告诉用户他们存了多少钱；也可能打算计算税费，但是可能会分开展现，而不是作为总价的一部分。

  小的、专注的计算属性减少了信息使用时的假设性限制，所以需求变更时也用不着那么多重构了。

```javascript
// 推荐
computed: {
  basePrice: function () {
    return this.manufactureCost / (1 - this.profitMargin)
  },
  discount: function () {
    return this.basePrice * (this.discountPercent || 0)
  },
  finalPrice: function () {
    return this.basePrice - this.discount
  }
}

// 不推荐
computed: {
  price: function () {
    var basePrice = this.manufactureCost / (1 - this.profitMargin)
    return (
      basePrice -
      basePrice * (this.discountPercent || 0)
    )
  }
}
```

## 私有属性名

**在插件、混入等扩展中始终为自定义的私有属性使用 `$_` 前缀。并附带一个命名空间以回避和其它作者的冲突 (比如 `$_yourPluginName_`)。**

Vue 使用 `_` 前缀来定义其自身的私有属性，所以使用相同的前缀 (比如 `_update`) 有覆写实例属性的风险。即便你检查确认 Vue 当前版本没有用到这个属性名，也不能保证和将来的版本没有冲突。
对于 `$` 前缀来说，其在 Vue 生态系统中的目的是暴露给用户的一个特殊的实例属性，所以把它用于*私有*属性并不合适。
不过，我们推荐把这两个前缀结合为 `$_`，作为一个用户定义的私有属性的约定，以确保不会和 Vue 自身相冲突。

```javascript
// 推荐
var myGreatMixin = {
  // ...
  methods: {
    $_myGreatMixin_update: function () {
      // ...
    }
  }
}

//  不推荐
var myGreatMixin = {
  // ...
  methods: {
    update: function () {
      // ...
    }
  }
}

var myGreatMixin = {
  // ...
  methods: {
    _update: function () {
      // ...
    }
  }
}

var myGreatMixin = {
  // ...
  methods: {
    $update: function () {
      // ...
    }
  }
}

var myGreatMixin = {
  // ...
  methods: {
    $_update: function () {
      // ...
    }
  }
}
```
